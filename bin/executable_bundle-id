#!/usr/bin/env bash
set -euo pipefail

show_help() {
  cat <<'USAGE'
Usage: bundle-id [--help] APP_NAME

Retrieve the bundle identifier of a macOS application by name.

Options:
  -h, --help   Show this help message and exit.

Examples:
  bundle-id "Comet"
USAGE
}

if [[ $# -eq 0 ]]; then
  echo "error: APP_NAME is required" >&2
  echo >&2
  show_help >&2
  exit 1
fi

case "$1" in
  -h|--help)
    show_help
    exit 0
    ;;
  --)
    shift
    ;;
  -*)
    echo "error: unknown option '$1'" >&2
    echo >&2
    show_help >&2
    exit 1
    ;;
esac

if [[ $# -ne 1 ]]; then
  echo "error: expected exactly one APP_NAME" >&2
  exit 1
fi

app_name="$1"

# Check if output is going to a terminal (not piped/redirected)
is_output_to_terminal() {
  [[ -t 1 ]]
}

bundle_id=$(osascript -e "id of app \"${app_name}\"")

# If output is to a terminal, include newline; if piped, don't
if is_output_to_terminal; then
  echo "$bundle_id"
else
  printf "%s" "$bundle_id"
fi
