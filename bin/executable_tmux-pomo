#! /usr/bin/env zsh

statefile="$HOME/.pomo"
pomo_length=1200

zparseopts -E -A args a=advance -advance=advance

# echo args: ${(kv)args}

function startCountdownAndUpdateState() {
	cntdwn -t $1 > /dev/null
	echo "$stateName" >$statefile
}

function startBreakTimeAndUpdateState() {
	cntdwn -up > /dev/null
	echo "$stateName" >$statefile
}

function advanceState() {
	if [[ $stateName = Pomo ]]; then
		stateName=Break
		startBreakTimeAndUpdateState
	else
		stateName=Pomo
		startCountdownAndUpdateState $pomo_length
	fi
}

#Starts here
if [[ -e $statefile ]]; then
	read stateName <$statefile
else
	return 0
fi

if [[ -n $advance ]]; then
	advanceState $stateName
elif [[ $stateName = Pomo ]]; then
	if [[ $(cntdwn -e) = 0 ]]; then
		advanceState $stateName
	fi
fi

print $stateName: $(cntdwn)
