# zmodload zsh/zprof
export ZSH_INIT="$HOME/.zsh"
source "$ZSH_INIT/shell_environment.zsh"

#oh-my-zsh from antibody cache
export ZSH="$(antibody home)/https-COLON--SLASH--SLASH-github.com-SLASH-robbyrussell-SLASH-oh-my-zsh"
export ZSH_CACHE_DIR="$ZSH/cache"

#update plugins when out of date
plugins_file="$ZSH_CACHE_DIR/zsh_plugins.zsh"
if [[ ! -e $plugins_file || $plugins_file -ot "$ZSH_INIT_plugins.txt" ]]; then
  echo updating plugins...
  antibody bundle < "$ZSH_INIT_plugins.txt" > $plugins_file
fi
source $plugins_file
# autoload -U compinit && compinit

source "$ZSH_INIT/gitenv.zsh"
source "$ZSH_INIT/path.zsh"
source "$ZSH_INIT/dir-aliases.zsh"
source "$ZSH_INIT/funcs.zsh"
source "$ZSH_INIT/custom_p10k.zsh"
source "$ZSH_INIT/fzf.zsh"

#launch tmux or attach to existing session
if [[ $LAUNCH_TMUX -eq 1 ]] && [[ -z "$TMUX" ]]; then
  cd "$HOME"
  tmux attach 2>/dev/null || exec tmux new
fi

if [[ $INSECURE_DOCKER -eq 1 ]]; then
  export DOCKER_HOST=tcp://127.0.0.1:2375 
fi

#disable tty XON/XOFF via ^S, ^Q
stty -ixon

#omit l and git status from history
HISTIGNORE='l:gst: '

#set SHELL in docker containers
if [[ -z $SHELL ]]; then
  export SHELL=$(which zsh)
fi

#user for theme to know when to display alternate username
DEFAULT_USER=$(whoami)

#k always human readable
alias k='k -h'

export EDITOR=nvim
export LESS=-RFMX
alias vim=nvim
alias v=nvim
alias opn="open_command"
